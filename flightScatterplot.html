<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: SVG bar chart with value labels (centered)</title>
		<script type="text/javascript" src="../d3.js"></script>
		<style type="text/css">

			<style>
			body {
			  font: 11px sans-serif;
			}

			.axis path,
			.axis line {
			  fill: none;
			  stroke: #000;
			  shape-rendering: crispEdges;
			}

			.dot {
			  stroke: #000;
			}

			.tooltip {
			  position: absolute;
			  width: 200px;
			  height: 28px;
			  pointer-events: none;
			}
			</style>
	
	</head>
	<body>
	<h1> is it working? </h1>	
		<script type="text/javascript">
			
			//Width and height
			var w = 960;
			var h = 960;
			var barPadding = 1;
			
			var dataset;
			var flightID = "banana";
			var destination;
			var departureTime
			var totalFlights;
			var emissions;


			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h)
						.attr("border", "5px solid black;");



			var xValue = function(d) { return d.minutes;}, // data -> value
		    xScale = d3.scaleLinear().range([0, w]), // value -> display
		    xMap = function(d) { return xScale(xValue(d));}, // data -> display
		    xAxis = d3.axisBottom(xMap);

		// setup y
			var yValue = function(d) { return d[emissions];}, // data -> value
		    yScale = d3.scaleLinear().range([h, 0]), // value -> display
		    yMap = function(d) { return yScale(yValue(d));}, // data -> display
		    yAxis = d3.axisLeft(yMap)
		// setup fill color

			var cValue = function(d) { return d.emissions;},
		    color = "blue";
			
			var tooltip = d3.select("body").append("div")
    		.attr("class", "tooltip")
    		.style("opacity", 0);


			console.log("it is starting 1");
			var generateURL = d3.json("/data.json", function(data){
					//builds the URL and generates distance AND emissions
					dataset = data
					flights = dataset.flights
					// console.log(distances)
					for (var i = 0; i < 50; i++) {
						var arrivalAirport = flights[i].arrivalAirportEnglish
						var urlFinal = ("http://www.distance24.org/route.json?stops=ARN|" + arrivalAirport)
						// console.log(urlFinal);
						var originalDate = dataset.flights[i].departureTime.scheduledUtc;
						var date = d3.timeParse(originalDate);
						var originalDateString = JSON.stringify(originalDate);
						var minutes = (originalDateString.charAt(12) + originalDateString.charAt(13));
						// console.log(minutes)						
						//console.log(label)
						//var emissions;						
						var getEmissions = d3.json(urlFinal, function(data){
							var realDistance = data.distance;
							//console.log(realDistance.toString())
							if (realDistance >= 463) {
								//console.log(realDistance * 0.257)
								 return realDistance * 0.257}
							else {
								return (realDistance * 0.177).toString}															
							});

					//console.log("this is flight number: " + label + " it left arlanda " + originalDate + " with destination " + arrivalAirport ) 
					};
					for (var i = 0; i < 3; i++){
					var label = ("this is flight number: " + label + " it left arlanda " + originalDate + " with destination " + arrivalAirport ) 
					var createLabels = svg.selectAll("g")
							  .data(dataset.flights[i].flightId)
							  .enter()
							  .append("text")
							  .text(label);

				    var createBars = svg.selectAll("rect")
				    				   .data(dataset.flights[i].flightId)
									   .enter()
									   .append("rect");	
				    
				    bars = createBars	   
						   .attr("x", function(d,i){
						   		return (i * w/50) - minutes})
						   .attr("y", function(d, i) {
						   		return 50;
						   })
						   .attr("width", minutes)
						   .attr("height", function() {
						   		return 150;
						   })
						   .attr("fill", function(d) {
								return "rgb("+ minutes*13 +"," +minutes*5+"," + minutes*2 + ")";
								 });
					text = createLabels						   
						   .attr("x", function(d,i){
						   		return i* w/minutes})
						   .attr("y", function(d, i) {
						   		return 250;
						   })
						   .attr("font-family", "sans-serif")
						   .attr("font-size", "11px")
						   .attr("fill", "black")
						   .attr("width", 10);
				   	   
						};

					 }); 

					 
					svg.append("g")
				      .attr("class", "x axis")
				      .attr("transform", "translate(0," + h + ")")
				      .call(xAxis)
				    .append("text")
				      .attr("class", "label")
				      .attr("x", w)
				      .attr("y", -6)
				      .style("text-anchor", "end")
				      .text("SOMETHING");

					  // y-axis
					  // svg.append("g")
					  //     .attr("class", "y axis")
					  //     .call(yAxis)
					  //   .append("text")
					  //     .attr("class", "label")
					  //     .attr("transform", "rotate(-90)")
					  //     .attr("y", 6)
					  //     .attr("dy", ".71em")
					  //     .style("text-anchor", "end")
					  //     .text("Protein (g)");



	</script>
</body>
</html>